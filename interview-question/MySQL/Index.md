# 索引相关
1、数据库中某个表的`city`字段为上海的数据有490W条，为北京的数据有10W条，现在根据`city`去查上海的数据，会不会走索引呀？假设`city`是建立索引的
并不会走索引。
并不是所有索引对查询都有效，`SQL`是根据表中数据来进行查询优化的，当索引列有大量数据重复时,查询可能不会去利用索引，如一表中有字段`sex`，`male`、`female`几乎各一半，那么即使在`sex`上建了索引也对查询效率起不了作用。 

2、如果显示指定主键的话，`MySQL`会怎么做？
- 判断表中是否有非空的整形唯一索引,如果有,则该列为主键(这时候可以使用`select _rowid from table`查询到主键列)
- 如果没有符合条件的则会自动创建一个6字节的主键(该主键是查不到的)

# 悲观锁与乐观锁
1、什么叫做悲观锁、乐观锁
悲观锁：假定会发生并发冲突，屏蔽一切可能违反数据完整性的操作。比如说：每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block
乐观锁：假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性。每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在提交更新的时候会判断一下在此期间别人有没有去更新这个数据。乐观锁适用于读多写少的应用场景，这样可以提高吞吐量。

2、使用悲观锁、乐观锁去让`number` + 1
（1）悲观锁
```java 
SELECT * FROM table_a WHERE id=1 FOR UPDATE;
UPDATE table_a SET number=number-1 WHERE product_id=1;
# 线程执行完后，会自动释放锁的
```
（2）乐观锁
```java 
SELECT * FROM table_a WHERE id=1; # 查出此时number值为5
UPDATE table_a SET number=number-1 WHERE id=1 and number =5;
```
> 也可以使用版本锁或者时间戳的方式来实现

https://www.jianshu.com/p/f5ff017db62a

# 事务



